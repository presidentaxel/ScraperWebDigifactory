version: '3.8'

# Development docker-compose for local testing
services:
  scraper-dev:
    build: .
    container_name: digifactory-scraper-dev
    environment:
      - BASE_URL=${BASE_URL:-https://entrepreneur.digifactory.fr}
      - LOGIN_URL=${LOGIN_URL:-https://entrepreneur.digifactory.fr/digi/com/login}
      - USERNAME=${USERNAME}
      - PASSWORD=${PASSWORD}
      - SESSION_COOKIE=${SESSION_COOKIE}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE=${SUPABASE_SERVICE_ROLE}
      - SUPABASE_TABLE=${SUPABASE_TABLE:-digifactory_sales}
      - CONCURRENCY=2
      - BATCH_SIZE=10
      - RATE_PER_DOMAIN=0.5
      - TIMEOUT=20
      - MAX_RETRIES=5
      - LOG_LEVEL=DEBUG
    volumes:
      - ./data:/app/data
      - .:/app
    working_dir: /app
    command: python -m src.main --nr 52000 --dev --dry-run
    restart: "no"
    stdin_open: true
    tty: true

